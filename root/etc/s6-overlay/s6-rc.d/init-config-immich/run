#!/usr/bin/with-contenv bash

# make folders
mkdir -p \
    /config/machine-learning \
    /photos \
    /import \
    /run/immich

# check if /photos is empty
if [ -z "$(ls -A /photos)" ]; then
    lsiown -R abc:abc /photos
fi

# permissions
find /app/immich -path "*/node_modules" -prune -o -exec chown abc:abc {} +
lsiown -R abc:abc \
    /config \
    /photos \
    /run/immich \
    /usr/src/resources
