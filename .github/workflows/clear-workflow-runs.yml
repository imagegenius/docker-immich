# This file is automatically generated

name: Clear Workflow Runs CI

on:
  workflow_dispatch:
  schedule:
    - cron: "0 0 * * 6"

jobs:
  clear-workflow-runs:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Clear all workflow runs
        env:
          TOKEN: ${{ secrets.TOKEN }}
        run: |
          echo "${TOKEN}" | gh auth login --with-token
          runs=$(gh api repos/hydazz/docker-immich/actions/runs | jq -r .total_count)
          while true; do
          	if [[ $(gh api repos/hydazz/docker-immich/actions/runs | jq -r .total_count) -gt 2 ]]; then
          		gh api repos/hydazz/docker-immich/actions/runs \
          			--paginate -q '.workflow_runs[] | "\(.id)"' | \
          			xargs -n1 -I % gh api repos/hydazz/docker-immich/actions/runs/% -X DELETE || true
          	else
          		exit 0
          	fi
          done
